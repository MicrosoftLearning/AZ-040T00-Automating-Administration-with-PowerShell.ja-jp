---
lab:
  title: 'ラボ: PowerShell を使用したリモート管理の実行'
  module: 'Module 8: Administering remote computers with Windows PowerShell'
---

# ラボ: PowerShell を使用したリモート管理の実行

## シナリオ

あなたは Adatum Corporation の管理者であり、Windows Server 2019 を実行しているサーバー上でメンテナンス タスクを実行する必要があります。 サーバーに物理的にアクセスすることはできず、代わりに Windows PowerShell リモート処理を使用してタスクを実行する予定です。 また、サーバーと、Windows 10 を実行している別のクライアント コンピューターの両方で実行するタスクもいくつかあります。 あなたの環境では、ローカル コンピューターとサーバーとの間で、リモート プロシージャ コール (RPC) などの通信プロトコルはブロックされています。 あなたは Windows PowerShell リモート処理を使用することを予定しており、セッションを使用して永続性を確保し、即席のリモート処理接続で発生するセットアップとクリーンアップのオーバーヘッドを削減したいと考えています。

## 目標

このラボを完了すると、次のことができるようになります。

- クライアント コンピューターでリモート処理を有効にする。
- 一対一のリモート処理を使用して、リモート コンピューター上でタスクを実行する。
- 一対多のリモート処理を使用して、2 台のコンピューター上でタスクを実行する。
- PSSession を作成して管理する。
- コマンドを複数のコンピューターに並列で送信する。

## 予想所要時間: 60 分

## ラボのセットアップ

仮想マシン:

- **LON-DC1**
- **LON-CL1**

ユーザー名: **Adatum\\Administrator**

パスワード: **Pa55w.rd**

このラボでは、提供されている仮想マシン環境を使用します。 ラボを開始する前に、次の手順を行ってください。

1. **LON-DC1** を開いて、**Administrator** として、パスワード **Pa55w.rd** を使用してサインインします。
1. **LON-CL1** について手順 1 を繰り返します。

## 演習 1:ローカル コンピューターでのリモート処理の有効化

### シナリオ 1

この演習では、クライアント コンピューターでリモート処理を有効にします。

この演習の主なタスクは次のとおりです。

- 着信接続に対してリモート処理を有効にする。

### タスク 1: 着信接続に対してリモート処理を有効にする

1. **Adatum\\Administrator** として **LON-CL1** にサインインしていることを確認します。
1. Windows PowerShell コマンド ウィンドウが開いていることを確認します。
1. **ExecutionPolicy** が **RemoteSigned** に設定されていることを確認します。
1. **LON-CL1** クライアント コンピューターで着信接続のリモート処理を有効にします。
1. Windows PowerShell でセッション構成が複数作成されたことを確認します。 このリストを生成できるコマンドを見つける必要があります。

## 演習 2:一対一のリモート処理の実行

### シナリオ 2

この演習では、リモート コンピューターに接続し、メンテナンス タスクを実行します。

この演習の主なタスクは次のとおりです。

1. リモート コンピューターに接続し、オペレーティング システム機能をインストールする。
1. マルチホップ リモート処理をテストする。
1. リモート処理の制限事項を確認する。

### タスク 1: リモート コンピューターに接続し、オペレーティング システム機能をインストールする

1. **LON-CL1** に引き続きサインインしていることを確認します。
1. **LON-CL1** の Windows PowerShell コンソールで、リモート処理を使用して **LON-DC1** への一対一の接続を確立します。
1. **LON-DC1** にネットワーク負荷分散 (NLB) 機能をインストールします。
1. **LON-DC1** から接続解除します。

### タスク 2: マルチホップ リモート処理をテストする

1. **LON-DC1** への一対一のリモート処理接続を確立します。
1. **LON-DC1** から **LON-CL1** への接続の確立を試みます。 何が行われますか。また、その理由は何ですか。
1. 接続を閉じます。

### タスク 3: リモート処理の制限事項を確認する

1. コンピューター名 **localhost** を使用して、**LON-CL1** への一対一のリモート処理接続を確立します。 これはローカル コンピューターですが、この新しい接続により、コンピューター上に 2 番目のユーザー セッションが作成されます。
1. Windows PowerShell を使用して、メモ帳の新しいインスタンスを起動します。 何が行われますか。また、その理由は何ですか。
1. パイプラインを停止してメモ帳のプロセスを終了します。
1. 接続を閉じます。

## 演習 3:一対多のリモート処理の実行

この演習では、複数のコンピューターに対してコマンドを実行します。 そのうちの 1 つはクライアント コンピューターですが、それに対する 2 番目のサインインを各コマンドの継続中に確立します。

この演習の主なタスクは次のとおりです。

1. 2 台のコンピューターから物理ネットワーク アダプターのリストを取得する。
1. ローカル コマンドの出力をリモート コマンドのものと比較する。

### タスク 1: 2 台のコンピューターから物理ネットワーク アダプターのリストを取得する

1. **LON-CL1** 上で **adapter** などのキーワードを使用して、ネットワーク アダプターを一覧表示できるコマンドを見つけます。
1. コマンドのヘルプを確認し、出力を物理アダプターに制限する switch パラメーターを見つけます。
1. リモート処理を使用して、**LON-CL1** と **LON-DC1** の両方でコマンドを実行します。

### タスク 2: ローカル コマンドの出力をリモート コマンドのものと比較する

1. パイプを使用して **Process** オブジェクトのコレクションを **Get-Member** に渡します。
2. リモート処理を使用して **LON-DC1** から **Process** オブジェクトのリストを取得し、パイプを使用して **Get-Member** に渡します。
3. 2 つの **Get-Member** の結果出力を比較します。

## 演習 4:暗黙的なリモート処理の使用

この演習では、暗黙的なリモート処理を使用して、リモート コンピューターからコマンドをインポートして実行します。

この演習の主なタスクは次のとおりです。

1. サーバーへの永続的なリモート処理接続を作成する。
1. サーバーからモジュールをインポートして使用する。
1. 開いているすべてのリモート処理接続を閉じる。

### タスク 1: サーバーへの永続的なリモート処理接続を作成する

1. **LON-CL1** で、**Adatum\\Administrator** として、パスワード **Pa55w.rd** を使用してサインインします。
2. **[スタート]** メニューを選択してから、「**powersh**」と入力します。
3. 結果リストで、**[Windows PowerShell]** を右クリックするか、そのコンテキスト メニューをアクティブにしてから、**[管理者として実行]** を選択します。
4. Windows PowerShell コマンド ウィンドウで、**LON-DC1** への永続的なリモート処理接続を作成し、生成された PSSession オブジェクトを変数 `$dc` に保存します。
5. `$dc` 内の PSSession のリストを表示し、それらを使用できることを確認します。

### タスク 2: サーバーからモジュールをインポートして使用する

1. **LON-CL1** から、**LON-DC1** 上の Windows PowerShell モジュールのリストを表示します。
1. サーバー メッセージ ブロック (SMB) 共有を使用できるモジュールを **LON-DC1** 上で見つけます。
1. そのモジュールをローカル コンピューターにインポートし、インポートされた各コマンドの名詞にプレフィックス **DC** を追加します。
1. **LON-DC1** 上の SMB 共有のリストを表示します。
1. クライアント コンピューター上の SMB 共有のリストを表示します。

### タスク 3: 開いているすべてのリモート処理接続を閉じる

- Windows PowerShell コンソールで、開いているすべてのリモート処理接続を閉じます。

## エクササイズ 5:複数のコンピューターの管理

この演習では、PSSession を使用して永続性を確保し、複数のコンピューターに対していくつかの管理タスクを実行します。

この演習の主なタスクは次のとおりです。

1. 2 台のコンピューターに対する PSSession を作成する。
1. 2 台のコンピューターの Windows ファイアウォール規則を表示するレポートを作成する。
1. 2 台のコンピューターからのローカル ディスク情報を表示する HTML レポートを作成して表示する。
1. 開いているすべての PSSession を閉じる。

### タスク 1: 2 台のコンピューターに対する PSSession を作成する

1. **Windows PowerShell** コンソールで、**LON-CL1** と **LON-DC1** の両方に対する PSSession を作成します。
1. 両方の PSSession オブジェクトを変数 `$computers` に保存します。
1. `$computers の接続が開かれていて使用できることを確認します。

### タスク 2: 2 台のコンピューターの Windows ファイアウォール規則を表示するレポートを作成する

1. ネットワーク セキュリティに対応した Windows PowerShell モジュールを見つけます。
1. 1 行のコマンド ラインを使用して、**LON-CL1** と **LON-DC1** の両方のメモリにモジュールを読み込みます。
1. Windows ファイアウォール規則を表示できるコマンドを見つけます。
1. 1 行のコマンド ラインを使用して、**LON-CL1** と **LON-DC1** の両方で有効になっているファイアウォール規則を一覧表示します。
1. 規則の名前と、各規則の元になっているコンピューターの名前のみを表示します。
1. 1 行のコマンド ラインを使用して、**LON-CL1** と **LON-DC1** の両方のメモリからネットワーク セキュリティ モジュールをアップロードします。

### タスク 3: 2 台のコンピューターからのローカル ディスク情報を表示する HTML レポートを作成して表示する

1. テストとして、**Get-WmiObject** を使用して、ローカル ハード ドライブ (ドライブの種類が **3** のドライブだけを含むようにフィルターを適用した **Win32_LogicalDisk** クラス) のリストを表示します。
1. **LON-DC1** と **LON-CL1** の両方に対して、リモート処理を使用して **Get-WmiObject** コマンドをもう一度実行します。 **Get-WmiObject** コマンドに **–ComputerName** パラメーターを追加しないでください。

   > **注:** レポートには、各コンピューターの名前、各ドライブの文字と空き領域、合計サイズ (バイト単位) を含める必要があります。

### タスク 4: 開いているすべての PSSession を閉じる

- **Windows PowerShell** コンソールで、開いているすべての PSSession を閉じます。
